<!-- portfolio-operations-card.component.html -->
<div class="portfolio-operations-card">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="loading-text">Loading operations...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && asset" class="operations-container">
    <!-- Header Bar -->
    <div class="operations-header">
      <div class="header-left">
        <button 
          class="back-button"
          (click)="onBackClick()"
          aria-label="Go back to portfolio">
          <i class="fas fa-arrow-left"></i>
        </button>

        <div class="header-title">
          <i class="fas fa-exchange-alt header-icon"></i>
          <div class="title-content">
            <h5 class="mb-0">Operations</h5>
            <span class="asset-code-header">{{ asset.tradingCode }}</span>
          </div>
        </div>
      </div>

      <div class="header-stats">
        <div class="stat-item">
          <span class="stat-label">Quantity</span>
          <span class="stat-value">{{ asset.quantity | number:'1.0-4' }}</span>
        </div>

        <div class="stat-divider"></div>

        <div class="stat-item">
          <span class="stat-label">Avg. Price</span>
          <span class="stat-value">
            {{ toNumber(asset.averagePrice) | currency: currency:'symbol':'1.2-2' }}
          </span>
        </div>

        <div class="stat-divider"></div>

        <div class="stat-item">
          <span class="stat-label">Total Value</span>
          <span class="stat-value">
            {{ toNumber(asset.totalValue) | currency: currency:'symbol':'1.2-2' }}
          </span>
        </div>

        <div class="stat-divider"></div>

        <div class="stat-item">
          <span class="stat-label">Realized P&L</span>
          <span 
            class="stat-value"
            [ngClass]="{
              'text-profit': isProfitable(asset.realizedProfitLoss),
              'text-loss': isLoss(asset.realizedProfitLoss)
            }">
            <i 
              class="fas stat-icon"
              [ngClass]="getProfitLossIcon(asset.realizedProfitLoss)">
            </i>
            {{ toNumber(asset.realizedProfitLoss) | currency: currency:'symbol':'1.2-2' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Operations List -->
    <div class="operations-list">
      <div 
        *ngFor="let operation of asset.operations; trackBy: trackByOperationIndex"
        class="operation-card"
        [ngClass]="getOperationTypeClass(operation.type)"
        (click)="onOperationClick(operation)"
        role="button"
        tabindex="0"
        [attr.aria-label]="'View details for ' + operation.type + ' operation'"
        (keydown.enter)="onOperationClick(operation)"
        (keydown.space)="onOperationClick(operation)">
        
        <!-- Operation Header -->
        <div class="operation-header">
          <div class="operation-type-section">
            <span 
              class="badge operation-type-badge"
              [ngClass]="getOperationTypeBadgeClass(operation.type)">
              <i class="fas" [ngClass]="getOperationTypeIcon(operation.type)"></i>
              {{ operation.type }}
            </span>
            <span class="operation-date">
              <i class="fas fa-calendar-alt"></i>
              {{ formatDate(operation.date) }}
            </span>
          </div>
          <i class="fas fa-chevron-right operation-arrow"></i>
        </div>

        <!-- Operation Details -->
        <div class="operation-details">
          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-label">
                <i class="fas fa-layer-group"></i>
                Quantity
              </span>
              <span class="detail-value">{{ operation.quantity | number:'1.0-4' }}</span>
            </div>

            <div class="detail-item">
              <span class="detail-label">
                <i class="fas fa-tag"></i>
                Price
              </span>
              <span class="detail-value">
                {{ toNumber(operation.price) | currency: currency:'symbol':'1.2-2' }}
              </span>
            </div>

            <div class="detail-item">
              <span class="detail-label">
                <i class="fas fa-chart-bar"></i>
                Market Type
              </span>
              <span class="detail-value">{{ operation.marketType }}</span>
            </div>

            <div class="detail-item">
              <span class="detail-label">
                <i class="fas fa-calculator"></i>
                Total
              </span>
              <span class="detail-value detail-value-highlight">
                {{ calculateOperationTotal(operation) | currency: currency:'symbol':'1.2-2' }}
              </span>
            </div>
          </div>

<!--           <div class="detail-row">
            <div class="detail-item">
              <span class="detail-label">
                <i class="fas fa-chart-bar"></i>
                Market Type
              </span>
              <span class="detail-value">{{ operation.marketType }}</span>
            </div>

            <div class="detail-item">
              <span class="detail-label">
                <i class="fas fa-calculator"></i>
                Total
              </span>
              <span class="detail-value detail-value-highlight">
                {{ calculateOperationTotal(operation) | currency: currency:'symbol':'1.2-2' }}
              </span>
            </div>
          </div> -->
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="getOperationsCount() === 0" class="empty-state">
      <i class="fas fa-inbox empty-icon"></i>
      <h6 class="empty-title">No operations yet</h6>
      <p class="empty-text">This asset doesn't have any operations registered.</p>
    </div>
  </div>

  <!-- No Data State -->
  <div *ngIf="!loading && !asset" class="no-data-state">
    <i class="fas fa-exclamation-circle no-data-icon"></i>
    <h6 class="no-data-title">No asset selected</h6>
    <p class="no-data-text">Please select an asset to view its operations.</p>
  </div>
</div>